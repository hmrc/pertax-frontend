@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.ConfigDecorator
@import controllers.auth.requests.UserRequest
@import uk.gov.hmrc.renderer.TemplateRenderer
@import viewmodels.{AddressRowModel, ExtraLinks, PersonalDetailsTableRowModel}

@import scala.concurrent.ExecutionContext

@this(mainView: MainView)
@(personalDetails: Seq[PersonalDetailsTableRowModel],
        addressDetails: AddressRowModel,
        trustedHelpers: Option[PersonalDetailsTableRowModel],
        paperlessHelpers: Option[PersonalDetailsTableRowModel],
        signinDetailsHelpers: Option[PersonalDetailsTableRowModel])(implicit request: UserRequest[_], configDecorator: ConfigDecorator, templateRenderer: TemplateRenderer, messages: play.api.i18n.Messages, ec: ExecutionContext)

@rowsPresenter(row: PersonalDetailsTableRowModel, extraLinks: List[ExtraLinks] = Nil) = {
    <div class="govuk-summary-list__row" id="@row.id">
        <dt class="govuk-summary-list__key">
        @messages(row.titleMessage)
        </dt>
        <dd class="govuk-summary-list__value">
        @row.content
        </dd>
        <dd class="govuk-summary-list__actions">
        @row.linkUrl.map { url =>
        <a class="govuk-link" href="@url">

            @messages(row.linkTextMessage) @if(row.visuallyhiddenText.nonEmpty) {
            <span class="visuallyhidden">@messages(row.visuallyhiddenText)</span>
        }
        </a>
        }.getOrElse(
            Html(s"<p>${messages(row.linkTextMessage)}</p>")
        )

        @extraLinks.map { url =>
            <a class="govuk-link yourProfileExtraLink" href="@url.linkUrl">

                @messages(url.linkTextMessage) @if(row.visuallyhiddenText.nonEmpty) {
                <span class="visuallyhidden">@messages(row.visuallyhiddenText)</span>
            }
            </a>
        }
        </dd>
    </div>
}


@addressRowsPresenter(addressRow: Option[PersonalDetailsTableRowModel], isMainAddress: Boolean, extraLinks: List[ExtraLinks] = Nil) = {
    @{
        addressRow match {
            case Some(row) => rowsPresenter(row, extraLinks)
            case _ => emptyAddressRow(isMainAddress)
        }
    }
}

@emptyAddressRow(isMainAddress: Boolean) = {
    @if(isMainAddress) {
        <div class="govuk-summary-list__row" id="main_address">
            <dt class="govuk-summary-list__key">
            @messages("label.main_address")
            </dt>
            <dd class="govuk-summary-list__value">
            </dd>
            <dd class="govuk-summary-list__actions">
                <a class="govuk-link" href=@AddressRowModel.changeMainAddressUrl(configDecorator)>
                    @messages("label.change") <span class="visuallyhidden">@messages("label.your_main_home")</span>
                </a>
            </dd>
        </div>
    } else {
        <div class="govuk-summary-list__row" id="postal_address">
            <dt class="govuk-summary-list__key">
            @messages("label.postal_address")
            </dt>
            <dd class="govuk-summary-list__value">
            </dd>
            <dd class="govuk-summary-list__actions">
                <a class="govuk-link" href=@AddressRowModel.changePostalAddressUrl>
                    @messages("label.change") <span class="visuallyhidden">@messages("label.your.postal_address")</span>
                </a>
            </dd>
        </div>
    }
}


@mainView(messages("label.your_personal_details"),Some(messages("label.your_personal_tax_account"))) {

  <div class="grid-row">
    <div class="column-two-thirds">

      <header class="page-heading">
        <h1 class="heading-xlarge">
          @request.name.map(upperCaseToTitleCase).getOrElse(messages("label.your_account"))
        </h1>
        <p class="heading-secondary"><span class="visuallyhidden">@messages("label.this.section.is") </span>@messages("label.your_profile")</p>
      </header>

      <div class="pertax-personal-details">
        <h2>@messages("label.personal_details")</h2>
          <dl class="govuk-summary-list">
              @personalDetails.map(row => rowsPresenter(row))

              @addressRowsPresenter(addressDetails.mainAddress, true)
              @addressRowsPresenter(addressDetails.postalAddress, false, addressDetails.extraPostalAddressLink().toList)

              @trustedHelpers.map(rowsPresenter(_))
              @paperlessHelpers.map(rowsPresenter(_))
              @signinDetailsHelpers.map(rowsPresenter(_))
          </dl>
      </div>
    </div>
  </div>

  <div class="flex-container grid-row pertax-personal-details">

  </div>
}
